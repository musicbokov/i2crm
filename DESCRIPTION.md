**Техническое задание на разработку**
===================================

### **1. Сформировать базу данных**
**1.1 Таблица "Экзамены"**

Таблица для хранения всех экзаменов, зарегистрированных в системе через вкладку **Расписание**

- [x] Сформировать миграцию по созданию таблицы `exams`

  | Поле | Тип поля | Описание поля |
    | ------ | ------ | ------ |
  | id | primary key, integer, autoincrement | Идентификатор записи |
  | name | string(10), unique | Название экзамена |
  | days | int | Кол-во дней для подготовки |

- [x] Создать сущность для таблицы 'exams'

**1.2 Таблица "Справочник типов расписания"**

Таблица для хранения типов расписания

- [x] Сформировать миграцию по созданию таблицы `schedule_types`

  | Поле | Тип поля | Описание поля |
  | ------ | ------ | ------ |
  | id | primary key, integer, autoincrement | Идентификатор записи |
  | name | string | Наименование типа |

- [x] Создать сущность для таблицы `schedule_types`
- [x] В сущность добавить константы с типами расписаний:
    - [x] 1 - экзамен
    - [x] 2 - подготовка

**1.3 Таблица "Расписание"**

Таблица для хранения хронологии проведения экзаменов и подготовки к ним

- [x] Сформировать миграцию по созданию таблицы `schedule`

  | Поле | Тип поля | Описание поля |
    | ------ | ------ | ------ |
  | id | primary key, integer, autoincrement | Идентификатор записи |
  | date | date | Дата проведения экзамена |
  | exam_id | int | Ссылка на экзамен |
  | type_id | string | Ссылка на тип расписания |

- [x] Добавить ограничение внешнего ключа для поля `exam_id` по удалению и изменению `cascade`
- [x] Добавить ограничение внешнего ключа для поля `type_id` по удалению и изменению `set null`
- [x] Создать сущность для таблицы `schedule`
- [x] В сущность добавить константы со статусам расписаний типа "Подготовка"
    - [x] 1 - Сформировано
    - [x] 2 - Не сформировано
    - [x] 3 - Отсутствует день подготовки
- [x] Реализовать связь с сущностями `exams` и `schedule_types`

**1.4 Таблица "Справочник кодов ошибок"**

Таблица для хранения кодов ошибок

- [x] Сформировать миграцию по созданию таблицы `exceptions_code`

  | Поле | Тип поля | Описание поля |
  | ------ | ------ | ------ |
  | id | primary key, integer, autoincrement | Идентификатор записи |
  | code | int, unique | Код ошибки |
  | name | string | Наименование ошибки |

- [x] Создать сущность для таблицы `exceptions_code`
- [x] В сущность добавить константы со всеми кодами ошибок
    - [x] 1 - Экзамен с таким названием уже зарегистрирован
    - [x] 2 - На ([дата]) уже назначено проведение другого экзамена ([экзамен])
    - [ ] 3 - 

### **2. Подключение необходимых библиотек и внешних файлов**
- [x] Осуществить подключение модуля `fullcalendar`
    - [x] Сформировать скачивание внешних файлов с помощью `composer` с помощью команды:
      ```
      composer require fullcalendar/fullcalendar
      ```
    - [x] Создать `asset` для подключения следующих файлов, соблюдая порядок:
        1. `/components/jquery/jquery.js`
        2. `/components/moment/moment.js`
        3. `/components/moment/locale/ru.js`
        4. `/components/fullcalendar/dist/fullcalendar.js`
        5. `/components/fullcalendar/dist/locale/ru.js`

### **3. Реализация страницы "Расписание"**

На странице "Расписание" для пользователя будет предоставлена возможность регистрировать экзамен и дату его проведения в
системе. Введенное название экзамена будет сопровождаться проверкой на уникальность, чтобы избежать повторного сохранения
одного и того же экзамена.

После успешного прохождения всех проверок в базу данных запишется экзамен (`exams`) и дата его проведения (`schedule_exams`)

**Работа с моделью**
- [x] Создать модель `ScheduleExamsModel` для регистрации экзамена и его расписания в системе
    - Добавить поля
        - [x] examName - Название экзамена
        - [x] examDate - Дата проведения экзамена
        - [x] preparingDays - Количество дней для подготовки
    - Добавить проверки
        - [x] Проверка на пустые поля
        - [x] Проверка поля `examName` на кол-во символов
        - [x] Проверка поля `examName` на латинские буквы с помощью регулярного выражения
        - [x] Проверка поля `preparingDays` на число, большее либо равное 1
        - [x] Проверка поля `examDate` на соответствие формату `Y-m-d`
    - Реализовать метод, который будет сохранять экзамен и его расписание в базу данных
        - [x] Выбрасывать исключение, если экзамен с таким названием уже существует
        - [x] Выбрасывать исключение, если на дату уже назначен другой экзамен
        - [x] Сохранение должно происходить при помощи транзакций

**Работа с представлением**
- [x] Добавить поля ввода в соответствии с полями из модели `ScheduleExamsModel`
- [x] `submit` кнопка "Сохранить", которая отправляет форму с данными
- [x] `button` кнопка "Очистить", которая очищает поля ввода
- [x] Отображать оповещение об успешном добавлении записи в базу данных
- [x] Отображать ошибки при валидации модели
- [x] Отображать ошибки выбрасываемых исключений при сохранении данных

### **4. Реализация страницы "Календарь"**

На странице "Календарь" для пользователя будет предоставлен выбор отображаемых типов (экзамен/подготовка) с помощью `checkbox`.
Расписание формирует записи в соответствии с выбранными типами.

**Работа с контроллером**
- [x] В `controllers` необходимо реализовать `action` (`get-schedule-exams-by-type`), который будет принимать `get`
  параметром тип расписания и в соответствии с типом возвращать `json` расписание

**Реализация виджета "Календарь"**
- [x] Создать класс, наследуемый от `yii\base\Widget`
- [x] Создать `asset` для загрузки модуля `fullcalendar`
- [x] Создать `js` файл, в котором:
    - [x] Инициализация `fullcalendar` будет осуществляться внутри функции:
      ```js
      function initCalendar(schedule) {
        (...)
      }
      
      //Пример использования initCalendar()
      tempSchedule = {
        '2021-09-03': 'testingNameExam1',
        '2021-09-13': 'testingNameExam2'
      }
      initCalendar(tempSchedule);
      ```
    - [x] Переопределить метод `viewRender`. Реализовать отображение дней подготовки/экзамена с помощью перебора массива
      с расписанием (`schedule`)

**Работа с представлением**
- [x] Добавить `input checkbox` в соответствии с имеющимися типами расписаний (экзамен/подготовка)
- [x] Добавить обработчик события для `input checkbox`, который будет получать массив с расписанием из запроса
  `get-schedule-exams-by-type` и инициализировать календарь с помощью функции `initCalendar` виджета Календарь
- [x] Добавить в представление виджет "Календарь"

### **5. Реализация страницы "Главная"**
На странице "Главная" пользователю будет доступен список экзаменов, с возможностью удаления.
Также будет кнопка "Сформировать расписание", при нажатии которой будут перезаписаны все записи с типом "подготовка"
в таблице `schedule_exams`. Даты подготовки должны формироваться исходя из всех дат проведения экзаменов.

В случае, если не остается свободного дня для подготовки к экзамену, то предупреждать об этом пометкой в списке с экзаменами.

**Работа с контроллером**
- [x] В `controllers` необходимо реализовать `action` (`delete`), который будет принимать `get` параметром
  идентификатор экзамена для удаления
- [ ] В `controllers` необходимо реализовать `action` (`create-schedule`), который будет вызывать операцию по созданию
  расписания
    - [ ] Возвращает `json` хранящий в себе информацию об экзаменах, для которых не удалось сформировать расписание

**Работа с представлением**
- [x] Отображать экзамены в виде таблицы со следующими параметрами
    - [x] Добавить обработчик события нажатия на `button` кнопку "Удалить", который будет отправлять `get` запрос с
      идентификатором экзамена на `action` `delete`

  | ID | Название экзамена | Статус расписания подготовки | Действие |
    | ------ | ------ | ------ | ------ |
  | 1 | testingExam1 | Сформировано | `button` кнопка "Удалить" |
  | 2 | testingExam2 | Не сформировано | `button` кнопка "Удалить" |
  | 3 | testingExam3 | Отсутствует день подготовки | `button` кнопка "Удалить" |
- [x] Отображать статусы в соответствии с расписанием типа подготовка:
    - [x] **Сформировано** - если в расписании присутствует день проведения экзамена и день подготовки к экзамену
    - [x] **Не сформировано** - если в расписании отсутствует день проведения экзамена и день подготовки к экзамену

- [ ] Добавить кнопку "Сформировать расписание"
    - [ ] Добавить обработчик события нажатия на кнопку, который будет вызывать `action` `create-schedule` и получать статус
      формирования расписания
    - [ ]  Выводить сообщение об успешном/не успешном завершении формирования расписания

### **6. Реализация класса для распределения дней подготовки**

Данный класс формирует расписание дней подготовки всегда однозначно.


